# 休息模式選擇功能說明

## ✅ 功能概述

用戶現在可以在主畫面選擇專注時間完成後的行為：
- **不休息** - 專注完成後停止，需手動開始下一個計時
- **短休息** - 自動切換到 5 分鐘短休息
- **長休息** - 自動切換到 15 分鐘長休息

## 📱 UI 展示

### 主畫面休息選擇器

在專注模式下，控制按鈕下方會顯示「完成後」選擇器：

```
┌─────────────────────────┐
│     完成後              │
│  ┌────┐ ┌────┐ ┌────┐ │
│  │ ✕  │ │ ☕ │ │ 🛏️ │ │
│  │不休│ │短休│ │長休│ │
│  │息  │ │息  │ │息  │ │
│  └────┘ └────┘ └────┘ │
└─────────────────────────┘
```

**特點：**
- ✅ 只在專注模式顯示
- ✅ 即時選擇，立即生效
- ✅ 選中項高亮顯示（紅色背景）
- ✅ 設定會自動保存

## 🎯 工作流程

### 自動休息流程：

1. **選擇休息模式**
   - 在主畫面選擇「短休息」或「長休息」

2. **開始專注時間**
   - 點擊播放按鈕，開始 25 分鐘專注

3. **專注完成**
   - 計時器完成
   - 顯示「完成」狀態約 1 秒

4. **自動切換**
   - 自動切換到選定的休息模式（短休息或長休息）
   - 顯示休息時長
   - **不會自動開始**，等待用戶手動按播放

5. **手動開始休息**
   - 用戶準備好後，點擊播放開始休息計時

### 不休息流程：

1. **選擇「不休息」**
   - 在主畫面選擇「不休息」圖示

2. **開始專注時間**
   - 點擊播放按鈕

3. **專注完成**
   - 計時器完成並停止
   - **不會自動切換模式**
   - 停留在專注模式，等待用戶操作

## 🔧 技術實作

### 新增檔案：

1. **RestMode.swift**
   ```swift
   enum RestMode: String, Codable, CaseIterable {
       case none        // 不休息
       case shortBreak  // 短休息
       case longBreak   // 長休息
   }
   ```

2. **RestModeSelector.swift**
   - 休息模式選擇器 UI 組件
   - 三個選項按鈕
   - 選中狀態視覺回饋

### 修改檔案：

1. **TimerSettings.swift**
   - 添加 `autoRestMode: RestMode` 屬性
   - 預設值：`.shortBreak`

2. **TimerEngine.swift**
   - 修改 `handleCompletion()` 方法
   - 專注完成後檢查 `autoRestMode` 設定
   - 自動切換到對應的休息模式（如果設定了）
   - 使用 1 秒延遲讓用戶看到完成狀態

3. **TimerViewModel.swift**
   - 添加 `updateRestMode(_ mode: RestMode)` 方法
   - 更新設定並保存

4. **TimerScreen.swift**
   - 在專注模式下顯示 `RestModeSelector`
   - 綁定到 ViewModel 的更新方法

5. **SettingsView.swift**
   - 保存時保留 `autoRestMode` 設定

## 📋 功能特點

### ✅ 智能切換

- **專注完成後才切換**：只有專注模式完成才會自動切換
- **休息完成不切換**：短休息或長休息完成後不會自動返回專注
- **尊重用戶選擇**：如果選擇「不休息」，完全不切換

### ✅ 狀態保存

- **即時生效**：點擊選項立即更新設定
- **持久化**：設定儲存在 UserDefaults
- **重啟保留**：重新啟動 App 後保留選擇

### ✅ 用戶體驗

- **視覺回饋**：選中項紅色高亮
- **清晰圖示**：每個選項有對應圖示
  - ✕ 不休息：xmark.circle
  - ☕ 短休息：cup.and.saucer.fill
  - 🛏️ 長休息：bed.double.fill
- **只在需要時顯示**：只在專注模式顯示選擇器

## 🧪 測試場景

### 場景 1：短休息流程
```
1. 選擇「短休息」
2. 開始專注（25分鐘）
3. 等待完成
4. ✅ 確認自動切換到短休息（5分鐘）
5. ✅ 確認時間顯示為 05:00
6. 手動點擊播放開始休息
```

### 場景 2：長休息流程
```
1. 選擇「長休息」
2. 開始專注（25分鐘）
3. 等待完成
4. ✅ 確認自動切換到長休息（15分鐘）
5. ✅ 確認時間顯示為 15:00
6. 手動點擊播放開始休息
```

### 場景 3：不休息流程
```
1. 選擇「不休息」
2. 開始專注（25分鐘）
3. 等待完成
4. ✅ 確認停留在專注模式
5. ✅ 確認計時器停止，不自動切換
```

### 場景 4：設定持久化
```
1. 選擇「長休息」
2. 完全關閉 App
3. 重新啟動 App
4. ✅ 確認「長休息」仍然被選中
```

### 場景 5：中途更改
```
1. 選擇「短休息」
2. 開始專注
3. 暫停計時器
4. 更改選擇為「長休息」
5. 繼續計時
6. 等待完成
7. ✅ 確認切換到長休息（不是短休息）
```

## 🎨 設計細節

### 顏色方案：
- **未選中**：白色背景，深灰文字
- **選中**：紅色背景（#FF6347），白色文字
- **容器**：淺灰背景（#F5F5F5）

### 間距：
- 選項之間：12pt
- 上下內邊距：16pt
- 左右內邊距：20pt
- 圓角：16pt（容器），12pt（按鈕）

### 陰影：
- 未選中：淡陰影（opacity 0.05）
- 選中：中陰影（opacity 0.15）

## 💡 使用建議

### 推薦設定：

**標準番茄鐘工作法：**
- 選擇「短休息」
- 完成 4 個專注後，手動切換到「長休息」

**連續專注模式：**
- 選擇「不休息」
- 完成一個專注後決定是否繼續

**強制休息模式：**
- 選擇「短休息」或「長休息」
- 確保每次專注後都有休息

## 📊 編譯狀態

```
✅ BUILD SUCCEEDED
```

**新增檔案：**
- `RestMode.swift`
- `RestModeSelector.swift`

**修改檔案：**
- `TimerSettings.swift`
- `TimerEngine.swift`
- `TimerViewModel.swift`
- `TimerScreen.swift`
- `SettingsView.swift`

## 🎉 總結

這個功能讓用戶完全掌控他們的番茄鐘工作流程：

✅ **靈活性** - 三種模式適應不同工作習慣
✅ **自動化** - 減少手動操作，保持專注
✅ **可控性** - 隨時更改設定，即時生效
✅ **持久化** - 設定保存，無需重複配置

現在就可以在 Xcode 中運行並體驗這個新功能了！🍅⏱️
